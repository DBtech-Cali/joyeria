import React, { useState, useEffect } from 'react';
import { Plus, History, TrendingUp, TrendingDown, Edit3, Save, X, Eye } from 'lucide-react';

const AmatheaApp = () => {
  // Estados principales
  const [currentView, setCurrentView] = useState('catalog');
  const [passwordInput, setPasswordInput] = useState('');
  const [showPasswordModal, setShowPasswordModal] = useState(false);
  const [pendingView, setPendingView] = useState('');
  const [joyas, setJoyas] = useState([]);
  const [egresos, setEgresos] = useState([]);
  const [selectedJoya, setSelectedJoya] = useState(null);
  const [editingJoya, setEditingJoya] = useState(null);
  const [showAddModal, setShowAddModal] = useState(false);
  const [showEgresoModal, setShowEgresoModal] = useState(false);
  const [showSaleModal, setShowSaleModal] = useState(false);
  const [compradorNombre, setCompradorNombre] = useState('');

  // Estados para formularios
  const [newJoya, setNewJoya] = useState({
    nombre: '',
    peso: '',
    color: '',
    foto: '',
    joyero: 'joyero1',
    precio: '',
    estado: 'Cat√°logo',
    tipo: 'arete',
    comprador: '',
    distribucion: { joyero: 35, taller: 35, formacion: 30 }
  });

  const [newEgreso, setNewEgreso] = useState({
    nombre: '',
    precio: '',
    categoria: 'joyero',
    joyeroNombre: ''
  });

  const joyeros = Array.from({length: 20}, (_, i) => `joyero${i + 1}`);
  const tipos = ['arete', 'anillo', 'pulsera', 'dije'];
  const estados = ['Cat√°logo', 'Venta', 'Alquiler'];

  // Funciones de autenticaci√≥n
  const checkPassword = (targetView) => {
    if (passwordInput === 'mompox') {
      setCurrentView(targetView);
      setShowPasswordModal(false);
      setPasswordInput('');
    } else {
      alert('Contrase√±a incorrecta');
    }
  };

  const requestAccess = (view) => {
    setPendingView(view);
    setShowPasswordModal(true);
  };

  // Funciones CRUD para joyas
  const addJoya = () => {
    if (!newJoya.nombre || !newJoya.precio) {
      alert('Por favor completa los campos obligatorios');
      return;
    }
    
    const joya = {
      ...newJoya,
      id: Date.now(),
      precio: parseFloat(newJoya.precio),
      peso: parseFloat(newJoya.peso) || 0,
      fechaCreacion: new Date().toISOString()
    };
    
    setJoyas(prev => [...prev, joya]);
    setNewJoya({
      nombre: '',
      peso: '',
      color: '',
      foto: '',
      joyero: 'joyero1',
      precio: '',
      estado: 'Cat√°logo',
      tipo: 'arete',
      comprador: '',
      distribucion: { joyero: 35, taller: 35, formacion: 30 }
    });
    setShowAddModal(false);
  };

  const updateJoya = (id, updates) => {
    setJoyas(prev => prev.map(joya => 
      joya.id === id ? { ...joya, ...updates } : joya
    ));
  };

  const sellJoya = (joya) => {
    if (!compradorNombre.trim()) {
      alert('Por favor ingresa el nombre del comprador');
      return;
    }
    
    updateJoya(joya.id, { 
      estado: 'Venta', 
      comprador: compradorNombre,
      fechaVenta: new Date().toISOString()
    });
    setShowSaleModal(false);
    setCompradorNombre('');
    setSelectedJoya(null);
  };

  // Funciones para egresos
  const addEgreso = () => {
    if (!newEgreso.nombre || !newEgreso.precio) {
      alert('Por favor completa todos los campos');
      return;
    }

    const egreso = {
      ...newEgreso,
      id: Date.now(),
      precio: parseFloat(newEgreso.precio),
      fecha: new Date().toISOString()
    };

    setEgresos(prev => [...prev, egreso]);
    setNewEgreso({
      nombre: '',
      precio: '',
      categoria: 'joyero',
      joyeroNombre: ''
    });
    setShowEgresoModal(false);
  };

  // C√°lculos financieros
  const calcularIngresos = () => {
    const joyasVendidas = joyas.filter(joya => joya.estado === 'Venta');
    let totales = { joyero: 0, taller: 0, formacion: 0 };
    
    joyasVendidas.forEach(joya => {
      const dist = joya.distribucion;
      totales.joyero += (joya.precio * dist.joyero) / 100;
      totales.taller += (joya.precio * dist.taller) / 100;
      totales.formacion += (joya.precio * dist.formacion) / 100;
    });
    
    return totales;
  };

  const calcularEgresos = () => {
    let totales = { joyero: 0, taller: 0, formacion: 0 };
    
    egresos.forEach(egreso => {
      totales[egreso.categoria] += egreso.precio;
    });
    
    return totales;
  };

  // Componente Modal de Contrase√±a
  const PasswordModal = () => (
    showPasswordModal && (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-6 rounded-lg shadow-lg">
          <h3 className="text-lg font-bold mb-4">Ingresa la contrase√±a</h3>
          <input
            type="password"
            value={passwordInput}
            onChange={(e) => setPasswordInput(e.target.value)}
            className="border rounded px-3 py-2 w-full mb-4"
            placeholder="Contrase√±a"
            onKeyPress={(e) => e.key === 'Enter' && checkPassword(pendingView)}
          />
          <div className="flex gap-2">
            <button
              onClick={() => checkPassword(pendingView)}
              className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
            >
              Acceder
            </button>
            <button
              onClick={() => {
                setShowPasswordModal(false);
                setPasswordInput('');
              }}
              className="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
            >
              Cancelar
            </button>
          </div>
        </div>
      </div>
    )
  );

  // Componente Header
  const Header = () => (
    <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6 mb-6">
      <div className="flex items-center justify-between">
        <div className="flex items-center">
          <div className="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-4">
            üíé
          </div>
          <div>
            <h1 className="text-3xl font-bold">Amathea</h1>
            <p className="text-sm opacity-90">‚Äì filigrana con coraz√≥n ‚ô•</p>
          </div>
        </div>
        <div className="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
          <span className="text-2xl">‚ú®</span>
        </div>
      </div>
    </div>
  );

  // Componente Navegaci√≥n
  const Navigation = () => (
    <div className="bg-white shadow-md mb-6">
      <div className="flex justify-center gap-4 p-4">
        <button
          onClick={() => setCurrentView('catalog')}
          className={`flex items-center gap-2 px-4 py-2 rounded ${
            currentView === 'catalog' ? 'bg-purple-600 text-white' : 'bg-gray-200'
          }`}
        >
          üíç Cat√°logo
        </button>
        <button
          onClick={() => requestAccess('add')}
          className="flex items-center gap-2 px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700"
        >
          <Plus size={16} /> Agregar Joya
        </button>
        <button
          onClick={() => requestAccess('history')}
          className="flex items-center gap-2 px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
        >
          <History size={16} /> Historial
        </button>
        <button
          onClick={() => requestAccess('income')}
          className="flex items-center gap-2 px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700"
        >
          <TrendingUp size={16} /> Ingresos
        </button>
        <button
          onClick={() => requestAccess('expenses')}
          className="flex items-center gap-2 px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700"
        >
          <TrendingDown size={16} /> Egresos
        </button>
      </div>
    </div>
  );

  // Vista Cat√°logo
  const CatalogView = () => {
    const joyasCatalogo = joyas.filter(joya => joya.estado === 'Cat√°logo');
    
    return (
      <div>
        <h2 className="text-2xl font-bold mb-4">Joyas Disponibles</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {joyasCatalogo.map(joya => (
            <div key={joya.id} className="bg-white rounded-lg shadow-md p-4 border">
              <div className="h-48 bg-gray-200 rounded mb-4 flex items-center justify-center">
                {joya.foto ? (
                  <img src={joya.foto} alt={joya.nombre} className="max-h-full max-w-full object-cover rounded" />
                ) : (
                  <span className="text-gray-500">Sin imagen</span>
                )}
              </div>
              <h3 className="font-bold text-lg mb-2">{joya.nombre}</h3>
              <p className="text-gray-600 mb-1">Peso: {joya.peso}g</p>
              <p className="text-2xl font-bold text-green-600 mb-4">${joya.precio?.toLocaleString()}</p>
              <div className="flex gap-2">
                <button
                  onClick={() => setSelectedJoya(joya)}
                  className="flex-1 bg-purple-600 text-white py-2 rounded hover:bg-purple-700 flex items-center justify-center gap-2"
                >
                  <Eye size={16} /> Ver
                </button>
                <button
                  onClick={() => {
                    setSelectedJoya(joya);
                    setShowSaleModal(true);
                  }}
                  className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700"
                >
                  Vender
                </button>
              </div>
            </div>
          ))}
        </div>

        {joyasCatalogo.length === 0 && (
          <p className="text-center text-gray-500 py-8">No hay joyas disponibles en el cat√°logo</p>
        )}
      </div>
    );
  };

  // Modal de detalle de joya
  const JoyaDetailModal = () => (
    selectedJoya && !showSaleModal && (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
          <div className="flex justify-between items-start mb-4">
            <h3 className="text-xl font-bold">{selectedJoya.nombre}</h3>
            <button
              onClick={() => setSelectedJoya(null)}
              className="text-gray-500 hover:text-gray-700"
            >
              <X size={20} />
            </button>
          </div>
          <div className="h-48 bg-gray-200 rounded mb-4 flex items-center justify-center">
            {selectedJoya.foto ? (
              <img src={selectedJoya.foto} alt={selectedJoya.nombre} className="max-h-full max-w-full object-cover rounded" />
            ) : (
              <span className="text-gray-500">Sin imagen</span>
            )}
          </div>
          <div className="space-y-2">
            <p><strong>Tipo:</strong> {selectedJoya.tipo}</p>
            <p><strong>Color:</strong> {selectedJoya.color}</p>
            <p><strong>Peso:</strong> {selectedJoya.peso}g</p>
            <p><strong>Joyero:</strong> {selectedJoya.joyero}</p>
            <p><strong>Precio:</strong> ${selectedJoya.precio?.toLocaleString()}</p>
          </div>
        </div>
      </div>
    )
  );

  // Modal de venta
  const SaleModal = () => (
    showSaleModal && selectedJoya && (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
          <h3 className="text-xl font-bold mb-4">Vender: {selectedJoya.nombre}</h3>
          <p className="mb-4">Precio: ${selectedJoya.precio?.toLocaleString()}</p>
          <input
            type="text"
            value={compradorNombre}
            onChange={(e) => setCompradorNombre(e.target.value)}
            className="border rounded px-3 py-2 w-full mb-4"
            placeholder="Nombre del comprador"
          />
          <div className="flex gap-2">
            <button
              onClick={() => sellJoya(selectedJoya)}
              className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
            >
              Confirmar Venta
            </button>
            <button
              onClick={() => {
                setShowSaleModal(false);
                setCompradorNombre('');
              }}
              className="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
            >
              Cancelar
            </button>
          </div>
        </div>
      </div>
    )
  );

  // Vista Agregar Joya
  const AddJoyaView = () => (
    <div className="max-w-2xl mx-auto">
      <h2 className="text-2xl font-bold mb-4">Agregar Nueva Joya</h2>
      <div className="bg-white rounded-lg shadow-md p-6">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-1">Nombre *</label>
            <input
              type="text"
              value={newJoya.nombre}
              onChange={(e) => setNewJoya({...newJoya, nombre: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Peso (g)</label>
            <input
              type="number"
              value={newJoya.peso}
              onChange={(e) => setNewJoya({...newJoya, peso: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Color</label>
            <input
              type="text"
              value={newJoya.color}
              onChange={(e) => setNewJoya({...newJoya, color: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">URL de la Foto</label>
            <input
              type="url"
              value={newJoya.foto}
              onChange={(e) => setNewJoya({...newJoya, foto: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Joyero</label>
            <select
              value={newJoya.joyero}
              onChange={(e) => setNewJoya({...newJoya, joyero: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            >
              {joyeros.map(joyero => (
                <option key={joyero} value={joyero}>{joyero}</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Precio *</label>
            <input
              type="number"
              value={newJoya.precio}
              onChange={(e) => setNewJoya({...newJoya, precio: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Estado</label>
            <select
              value={newJoya.estado}
              onChange={(e) => setNewJoya({...newJoya, estado: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            >
              {estados.map(estado => (
                <option key={estado} value={estado}>{estado}</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Tipo</label>
            <select
              value={newJoya.tipo}
              onChange={(e) => setNewJoya({...newJoya, tipo: e.target.value})}
              className="border rounded px-3 py-2 w-full"
            >
              {tipos.map(tipo => (
                <option key={tipo} value={tipo}>{tipo}</option>
              ))}
            </select>
          </div>
        </div>
        <div className="mt-6 flex gap-2">
          <button
            onClick={addJoya}
            className="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700"
          >
            Agregar Joya
          </button>
          <button
            onClick={() => setCurrentView('catalog')}
            className="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>
  );

  // Vista Historial
  const HistoryView = () => (
    <div>
      <h2 className="text-2xl font-bold mb-4">Historial de Joyas</h2>
      <div className="bg-white rounded-lg shadow-md overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Nombre</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Tipo</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Joyero</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Precio</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Estado</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Comprador</th>
                <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {joyas.map(joya => (
                <tr key={joya.id}>
                  <td className="px-4 py-3">
                    {editingJoya === joya.id ? (
                      <input
                        type="text"
                        value={joya.nombre}
                        onChange={(e) => updateJoya(joya.id, {nombre: e.target.value})}
                        className="border rounded px-2 py-1 text-sm"
                      />
                    ) : (
                      joya.nombre
                    )}
                  </td>
                  <td className="px-4 py-3">{joya.tipo}</td>
                  <td className="px-4 py-3">
                    {editingJoya === joya.id ? (
                      <select
                        value={joya.joyero}
                        onChange={(e) => updateJoya(joya.id, {joyero: e.target.value})}
                        className="border rounded px-2 py-1 text-sm"
                      >
                        {joyeros.map(joyero => (
                          <option key={joyero} value={joyero}>{joyero}</option>
                        ))}
                      </select>
                    ) : (
                      joya.joyero
                    )}
                  </td>
                  <td className="px-4 py-3">${joya.precio?.toLocaleString()}</td>
                  <td className="px-4 py-3">
                    {editingJoya === joya.id ? (
                      <select
                        value={joya.estado}
                        onChange={(e) => updateJoya(joya.id, {estado: e.target.value})}
                        className="border rounded px-2 py-1 text-sm"
                      >
                        {estados.map(estado => (
                          <option key={estado} value={estado}>{estado}</option>
                        ))}
                      </select>
                    ) : (
                      <span className={`px-2 py-1 rounded text-xs ${
                        joya.estado === 'Venta' ? 'bg-green-100 text-green-800' :
                        joya.estado === 'Cat√°logo' ? 'bg-blue-100 text-blue-800' :
                        'bg-yellow-100 text-yellow-800'
                      }`}>
                        {joya.estado}
                      </span>
                    )}
                  </td>
                  <td className="px-4 py-3">
                    {editingJoya === joya.id && joya.estado === 'Venta' ? (
                      <input
                        type="text"
                        value={joya.comprador || ''}
                        onChange={(e) => updateJoya(joya.id, {comprador: e.target.value})}
                        className="border rounded px-2 py-1 text-sm"
                        placeholder="Nombre comprador"
                      />
                    ) : (
                      joya.comprador || '-'
                    )}
                  </td>
                  <td className="px-4 py-3">
                    {editingJoya === joya.id ? (
                      <button
                        onClick={() => setEditingJoya(null)}
                        className="text-green-600 hover:text-green-800"
                      >
                        <Save size={16} />
                      </button>
                    ) : (
                      <button
                        onClick={() => setEditingJoya(joya.id)}
                        className="text-blue-600 hover:text-blue-800"
                      >
                        <Edit3 size={16} />
                      </button>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        {joyas.length === 0 && (
          <p className="text-center text-gray-500 py-8">No hay joyas registradas</p>
        )}
      </div>
    </div>
  );

  // Vista Ingresos
  const IncomeView = () => {
    const joyasVendidas = joyas.filter(joya => joya.estado === 'Venta');
    const ingresos = calcularIngresos();
    const egresosCalculados = calcularEgresos();
    const balances = {
      joyero: ingresos.joyero - egresosCalculados.joyero,
      taller: ingresos.taller - egresosCalculados.taller,
      formacion: ingresos.formacion - egresosCalculados.formacion
    };

    return (
      <div>
        <h2 className="text-2xl font-bold mb-4">Dashboard de Ingresos</h2>
        
        {/* Resumen financiero */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div className="bg-green-100 p-4 rounded-lg">
            <h3 className="font-bold text-green-800">Joyero</h3>
            <p className="text-2xl font-bold text-green-600">${ingresos.joyero.toLocaleString()}</p>
            <p className="text-sm text-green-700">Ingresos</p>
            <p className="text-sm text-red-600">-${egresosCalculados.joyero.toLocaleString()}</p>
            <p className={`text-lg font-bold ${balances.joyero >= 0 ? 'text-green-600' : 'text-red-600'}`}>
              Balance: ${balances.joyero.toLocaleString()}
            </p>
          </div>
          <div className="bg-blue-100 p-4 rounded-lg">
            <h3 className="font-bold text-blue-800">Taller</h3>
            <p className="text-2xl font-bold text-blue-600">${ingresos.taller.toLocaleString()}</p>
            <p className="text-sm text-blue-700">Ingresos</p>
            <p className="text-sm text-red-600">-${egresosCalculados.taller.toLocaleString()}</p>
            <p className={`text-lg font-bold ${balances.taller >= 0 ? 'text-green-600' : 'text-red-600'}`}>
              Balance: ${balances.taller.toLocaleString()}
            </p>
          </div>
          <div className="bg-purple-100 p-4 rounded-lg">
            <h3 className="font-bold text-purple-800">Formaci√≥n</h3>
            <p className="text-2xl font-bold text-purple-600">${ingresos.formacion.toLocaleString()}</p>
            <p className="text-sm text-purple-700">Ingresos</p>
            <p className="text-sm text-red-600">-${egresosCalculados.formacion.toLocaleString()}</p>
            <p className={`text-lg font-bold ${balances.formacion >= 0 ? 'text-green-600' : 'text-red-600'}`}>
              Balance: ${balances.formacion.toLocaleString()}
            </p>
          </div>
        </div>

        {/* Lista de joyas vendidas */}
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          <h3 className="text-lg font-bold p-4 bg-gray-50">Joyas Vendidas</h3>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Joya</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Comprador</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Precio</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Joyero</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Taller</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Formaci√≥n</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Distribuci√≥n</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {joyasVendidas.map(joya => {
                  const dist = joya.distribucion;
                  return (
                    <tr key={joya.id}>
                      <td className="px-4 py-3">{joya.nombre}</td>
                      <td className="px-4 py-3">{joya.comprador}</td>
                      <td className="px-4 py-3">${joya.precio?.toLocaleString()}</td>
                      <td className="px-4 py-3">${((joya.precio * dist.joyero) / 100).toLocaleString()}</td>
                      <td className="px-4 py-3">${((joya.precio * dist.taller) / 100).toLocaleString()}</td>
                      <td className="px-4 py-3">${((joya.precio * dist.formacion) / 100).toLocaleString()}</td>
                      <td className="px-4 py-3">
                        {editingJoya === joya.id ? (
                          <div className="flex gap-1 text-xs">
                            <input
                              type="number"
                              value={dist.joyero}
                              onChange={(e) => updateJoya(joya.id, {
                                distribucion: {
                                  ...dist,
                                  joyero: parseInt(e.target.value) || 0
                                }
                              })}
                              className="border rounded px-1 py-1 w-12"
                            />%
                            <input
                              type="number"
                              value={dist.taller}
                              onChange={(e) => updateJoya(joya.id, {
                                distribucion: {
                                  ...dist,
                                  taller: parseInt(e.target.value) || 0
                                }
                              })}
                              className="border rounded px-1 py-1 w-12"
                            />%
                            <input
                              type="number"
                              value={dist.formacion}
                              onChange={(e) => updateJoya(joya.id, {
                                distribucion: {
                                  ...dist,
                                  formacion: parseInt(e.target.value) || 0
                                }
                              })}
                              className="border rounded px-1 py-1 w-12"
                            />%
                            <button
                              onClick={() => setEditingJoya(null)}
                              className="text-green-600 ml-1"
                            >
                              <Save size={12} />
                            </button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-1">
                            <span className="text-xs">{dist.joyero}%/{dist.taller}%/{dist.formacion}%</span>
                            <button
                              onClick={() => setEditingJoya(joya.id)}
                              className="text-blue-600 ml-1"
                            >
                              <Edit3 size={12} />
                            </button>
                          </div>
                        )}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          {joyasVendidas.length === 0 && (
            <p className="text-center text-gray-500 py-8">No hay joyas vendidas</p>
          )}
        </div>
      </div>
    );
  };

  // Vista Egresos
  const ExpensesView = () => {
    const egresosCalculados = calcularEgresos();
    const egresosPorJoyero = {};
    
    egresos.forEach(egreso => {
      if (egreso.categoria === 'joyero' && egreso.joyeroNombre) {
        if (!egresosPorJoyero[egreso.joyeroNombre]) {
          egresosPorJoyero[egreso.joyeroNombre] = 0;
        }
        egresosPorJoyero[egreso.joyeroNombre] += egreso.precio;
      }
    });

    return (
      <div>
        <h2 className="text-2xl font-bold mb-4">Egresos</h2>
        
        <div className="mb-6">
          <button
            onClick={() => setShowEgresoModal(true)}
            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
          >
            Agregar Egreso
          </button>
        </div>

        {/* Resumen de egresos */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div className="bg-red-100 p-4 rounded-lg">
            <h3 className="font-bold text-red-800">Joyero</h3>
            <p className="text-2xl font-bold text-red-600">${egresosCalculados.joyero.toLocaleString()}</p>
          </div>
          <div className="bg-red-100 p-4 rounded-lg">
            <h3 className="font-bold text-red-800">Taller</h3>
            <p className="text-2xl font-bold text-red-600">${egresosCalculados.taller.toLocaleString()}</p>
          </div>
          <div className="bg-red-100 p-4 rounded-lg">
            <h3 className="font-bold text-red-800">Formaci√≥n</h3>
            <p className="text-2xl font-bold text-red-600">${egresosCalculados.formacion.toLocaleString()}</p>
          </div>
        </div>

        {/* Egresos por joyero */}
        {Object.keys(egresosPorJoyero).length > 0 && (
          <div className="bg-white rounded-lg shadow-md p-4 mb-6">
            <h3 className="text-lg font-bold mb-4">Egresos por Joyero</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
              {Object.entries(egresosPorJoyero).map(([joyero, total]) => (
                <div key={joyero} className="bg-gray-50 p-3 rounded">
                  <p className="font-medium">{joyero}</p>
                  <p className="text-lg font-bold text-red-600">${total.toLocaleString()}</p>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Lista de todos los egresos */}
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          <h3 className="text-lg font-bold p-4 bg-gray-50">Historial de Egresos</h3>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Concepto</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Categor√≠a</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Joyero</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Monto</th>
                  <th className="px-4 py-3 text-left text-sm font-medium text-gray-900">Fecha</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {egresos.map(egreso => (
                  <tr key={egreso.id}>
                    <td className="px-4 py-3">{egreso.nombre}</td>
                    <td className="px-4 py-3">
                      <span className={`px-2 py-1 rounded text-xs ${
                        egreso.categoria === 'joyero' ? 'bg-green-100 text-green-800' :
                        egreso.categoria === 'taller' ? 'bg-blue-100 text-blue-800' :
                        'bg-purple-100 text-purple-800'
                      }`}>
                        {egreso.categoria}
                      </span>
                    </td>
                    <td className="px-4 py-3">{egreso.joyeroNombre || '-'}</td>
                    <td className="px-4 py-3 font-bold text-red-600">${egreso.precio.toLocaleString()}</td>
                    <td className="px-4 py-3">{new Date(egreso.fecha).toLocaleDateString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          {egresos.length === 0 && (
            <p className="text-center text-gray-500 py-8">No hay egresos registrados</p>
          )}
        </div>
      </div>
    );
  };

  // Modal para agregar egreso
  const EgresoModal = () => (
    showEgresoModal && (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
          <h3 className="text-xl font-bold mb-4">Agregar Egreso</h3>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Concepto</label>
              <input
                type="text"
                value={newEgreso.nombre}
                onChange={(e) => setNewEgreso({...newEgreso, nombre: e.target.value})}
                className="border rounded px-3 py-2 w-full"
                placeholder="Descripci√≥n del gasto"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium mb-1">Monto</label>
              <input
                type="number"
                value={newEgreso.precio}
                onChange={(e) => setNewEgreso({...newEgreso, precio: e.target.value})}
                className="border rounded px-3 py-2 w-full"
                placeholder="0"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium mb-1">Categor√≠a</label>
              <select
                value={newEgreso.categoria}
                onChange={(e) => setNewEgreso({...newEgreso, categoria: e.target.value})}
                className="border rounded px-3 py-2 w-full"
              >
                <option value="joyero">Joyero</option>
                <option value="taller">Taller</option>
                <option value="formacion">Formaci√≥n</option>
              </select>
            </div>
            
            {newEgreso.categoria === 'joyero' && (
              <div>
                <label className="block text-sm font-medium mb-1">Nombre del Joyero</label>
                <input
                  type="text"
                  value={newEgreso.joyeroNombre}
                  onChange={(e) => setNewEgreso({...newEgreso, joyeroNombre: e.target.value})}
                  className="border rounded px-3 py-2 w-full"
                  placeholder="Nombre completo"
                />
              </div>
            )}
          </div>

          <div className="flex gap-2 mt-6">
            <button
              onClick={addEgreso}
              className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
            >
              Agregar Egreso
            </button>
            <button
              onClick={() => {
                setShowEgresoModal(false);
                setNewEgreso({
                  nombre: '',
                  precio: '',
                  categoria: 'joyero',
                  joyeroNombre: ''
                });
              }}
              className="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
            >
              Cancelar
            </button>
          </div>
        </div>
      </div>
    )
  );

  // Renderizado principal
  return (
    <div className="min-h-screen bg-gray-100">
      <Header />
      <div className="container mx-auto px-4">
        <Navigation />
        
        <div className="pb-8">
          {currentView === 'catalog' && <CatalogView />}
          {currentView === 'add' && <AddJoyaView />}
          {currentView === 'history' && <HistoryView />}
          {currentView === 'income' && <IncomeView />}
          {currentView === 'expenses' && <ExpensesView />}
        </div>
      </div>

      {/* Modales */}
      <PasswordModal />
      <JoyaDetailModal />
      <SaleModal />
      <EgresoModal />
    </div>
  );
};

export default AmatheaApp;
